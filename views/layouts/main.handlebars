<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>{{title}}</title>
    <link rel="stylesheet" href="/public/main_style.css">
</head>

<body>

    <main>

        <nav>
            <li><a href="/">Home</a></li>
            <li><a href="/playgrounds">Playgrounds</a></li>
            {{#if userLoggedIn}}
            <li><a href="/user/profile" id="profile">Profile</a></li>
            <li><a href="/host">Hosting</a></li>
            <li><a href="/restaurants/manage">Sport Trevia</a></li>
            <li><a href="/restaurants/manage">Sport Watching Event</a></li>
            <li><a href="/user/logout" id="logout">Logout</a></li>
            {{else}}
            <li><a href="/user/login" id="auth">Login</a></li>
            {{/if}}
        </nav>
        {{!-- <div class="topnav">
            <a class="active" href="#home">Home</a>
            <a href="#news">News</a>
            <a href="#contact">Contact</a>
            <a href="#about">About</a>
        </div> --}}
        {{{body}}}

         <script src="https://cdn.jsdelivr.net/npm/jquery@1.12.4/dist/jquery.min.js"></script>
    <script type="text/javascript">
        $('#addNewPostButton').click(function () {

            var form = document.getElementById('static-form');

            if (form) {
                var formData = new FormData(form);

                var file = document.getElementById('addImg')

                // count for photos user has chosen
                var fileCount = 0;
                $('#picTips').hide();

                // when user choose photos
                file.onchange = function () {
                    for (let i = 0; i < this.files.length; i++) {
                        formData.append('photo' + i, this.files[i]); // add photos' path to formData
                        fileCount++;
                    }
                    if (fileCount == 1) {
                        $('#picTips').text('You have chosen ' + fileCount + ' photo');
                        $('#picTips').show();
                    } else if (fileCount > 1 && fileCount <= 3) {
                        $('#picTips').text('You have chosen ' + fileCount + ' photos');
                        $('#picTips').show();
                    } else {
                        $('#picTips').text('You can only upload 3 photos at most');
                        $('#picTips').show();
                    }
                }
            }

            var xhr = new XMLHttpRequest();//创建 Ajax 对象

            var tagArr = [];
            $('input[type="checkbox"]:checked').each(function (index) {
                tagArr[index] = $(this).val();
            })
            let JSONData = JSON.stringify(tagArr);

            formData.set('tagArr', JSONData);
            formData.set("topic", $('#topicId').val());
            formData.set("content", $('#contentId').val());
            formData.delete('tag');
            formData.delete('photoArr');

            xhr.open('post', '/host/createPost');
            xhr.send(formData);

            xhr.onload = function () {//获取服务器端给与客户端的响应数据
                console.log(xhr.responseText);
                // alert("Succeed!")
                var Timeout = setTimeout(function () {
                    window.location.reload();
                }, 500);
            }
        })
    </script>

    </main>

</body>

</html>